<div class="edit-profile-container">
  <div class="edit-header">
    <h1>Public profile</h1>
  </div>

  <%= form_with model: @user, url: profile_path, local: true, class: "edit-profile-form" do |f| %>
    <% if @user.errors.any? %>
      <div class="error-messages">
        <h2><%= pluralize(@user.errors.count, "error") %> prohibited this profile from being saved:</h2>
        <ul>
          <% @user.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-row">
      <div class="form-main">
        <div class="form-group">
          <%= f.label :full_name, "Name" %>
          <%= f.text_field :full_name, class: "form-control", placeholder: "Your real name" %>
        </div>

        <div class="form-group">
          <%= f.label :username %>
          <%= f.text_field :username, class: "form-control", placeholder: "Choose a unique username" %>
          <p class="form-help">Your profile URL: <%= request.base_url %>/<span id="username-preview"><%= @user.username %></span></p>
        </div>

        <div class="form-group">
          <%= f.label :bio %>
          <%= f.text_area :bio, class: "form-control", rows: 3, placeholder: "Tell us a little about yourself" %>
        </div>

        <div class="form-group">
          <%= f.label :status, "Current Status" %>
          <%= f.text_field :status, class: "form-control", placeholder: "What's happening?" %>
        </div>

        <div class="form-group">
          <%= f.label :company %>
          <%= f.text_field :company, class: "form-control" %>
        </div>

        <div class="form-group">
          <%= f.label :location %>
          <%= f.text_field :location, class: "form-control" %>
        </div>

        <div class="form-group">
          <%= f.label :website %>
          <%= f.text_field :website, class: "form-control", placeholder: "https://yourwebsite.com" %>
        </div>

        <div class="form-group">
          <%= f.label :twitter_handle, "Twitter Username" %>
          <%= f.text_field :twitter_handle, class: "form-control", placeholder: "@username" %>
        </div>

        <div class="form-actions">
          <%= f.submit "Update Profile", class: "btn btn-primary" %>
          <%= link_to "Cancel", user_profile_path(@user.username), class: "btn btn-secondary" %>
        </div>
      </div>

      <div class="form-sidebar">
        <div class="avatar-upload">
          <%= f.label :avatar, "Profile picture" %>
          <div class="current-avatar">
            <% if @user.avatar.attached? %>
              <%= image_tag @user.avatar.variant(resize_to_fill: [200, 200]), class: "edit-avatar-preview" %>
            <% else %>
              <div class="edit-avatar-placeholder"><%= @user.username[0].upcase if @user.username %></div>
            <% end %>
          </div>
          <div class="upload-controls">
            <%= f.file_field :avatar, class: "file-input", accept: "image/*" %>
            <p class="form-help">Upload a new avatar. JPG, PNG or GIF.</p>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<style>
  .edit-profile-container { max-width: 900px; margin: 0 auto; }
  .edit-header { border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 2rem; }
  .edit-header h1 { font-size: 1.5rem; font-weight: 600; color: var(--text-primary); margin: 0; }

  .form-row { display: flex; gap: 4rem; }
  .form-main { flex: 2; }
  .form-sidebar { flex: 1; }

  .form-group { margin-bottom: 1.5rem; }
  .form-group label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary); font-size: 0.9rem; }
  .form-control { 
    width: 100%; padding: 8px 12px; 
    background: var(--bg-secondary); border: 1px solid var(--border-color); 
    border-radius: 6px; color: var(--text-primary); font-size: 0.95rem;
    transition: border-color 0.2s;
  }
  .form-control:focus { border-color: var(--accent-color); outline: none; box-shadow: 0 0 0 3px rgba(47, 129, 247, 0.2); }
  
  .form-help { font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.4rem; }
  
  .btn { 
    padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; 
    font-size: 0.9rem; border: 1px solid transparent; text-decoration: none;
    display: inline-block;
  }
  .btn-primary { background: var(--success-color); color: white; border-color: rgba(240, 246, 252, 0.1); }
  .btn-primary:hover { opacity: 0.9; }
  .btn-secondary { background: var(--bg-secondary); color: var(--text-primary); border-color: var(--border-color); margin-left: 0.5rem; }
  .btn-secondary:hover { background: #1f2428; }

  .avatar-upload label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary); font-size: 0.9rem; }
  .edit-avatar-preview { width: 200px; height: 200px; border-radius: 50%; border: 1px solid var(--border-color); margin-bottom: 1rem; }
  .edit-avatar-placeholder { 
    width: 200px; height: 200px; border-radius: 50%; 
    background: linear-gradient(135deg, #2f81f7, #bc8cf2); 
    display: flex; align-items: center; justify-content: center;
    font-size: 4rem; font-weight: 800; color: white;
    border: 1px solid var(--border-color); margin-bottom: 1rem;
  }
  .file-input { font-size: 0.8rem; color: var(--text-secondary); }

  .error-messages { 
    background: rgba(218, 54, 51, 0.1); border: 1px solid var(--danger-color); 
    color: var(--danger-color); padding: 1rem; border-radius: 6px; margin-bottom: 2rem; 
  }
  .error-messages h2 { font-size: 1rem; margin: 0 0 0.5rem; }
  .error-messages ul { margin: 0; padding-left: 1.5rem; font-size: 0.9rem; }

  @media (max-width: 768px) {
    .form-row { flex-direction: column-reverse; gap: 2rem; }
    .form-sidebar { align-self: center; text-align: center; }
  }
</style>

<script>
  document.addEventListener('input', (e) => {
    if (e.target.id === 'user_username') {
      const preview = document.getElementById('username-preview');
      if (preview) preview.textContent = e.target.value || 'username';
    }
  });
</script>
