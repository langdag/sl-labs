<div class="profile-container">
  <div class="profile-sidebar">
    <div class="profile-avatar-container">
      <% if @user.avatar.attached? %>
        <%= image_tag @user.avatar.variant(resize_to_fill: [296, 296]), class: "profile-avatar" %>
      <% else %>
        <div class="profile-avatar-placeholder">
          <%= @user.username[0].upcase if @user.username %>
        </div>
      <% end %>
      
      <% if @user.status.present? %>
        <div class="profile-status">
          <span class="status-icon">üí¨</span>
          <span class="status-text"><%= @user.status %></span>
        </div>
      <% end %>
    </div>

    <div class="profile-names">
      <h1 class="profile-full-name"><%= @user.full_name %></h1>
      <span class="profile-username"><%= @user.username %></span>
    </div>

    <div class="profile-bio">
      <%= @user.bio %>
    </div>

    <% if @user == current_user %>
      <%= link_to "Edit profile", edit_profile_path, class: "btn btn-edit-profile" %>
    <% end %>

    <div class="profile-meta">
      <% if @user.company.present? %>
        <div class="meta-item">
          <span class="meta-icon">üè¢</span>
          <%= @user.company %>
        </div>
      <% end %>
      <% if @user.location.present? %>
        <div class="meta-item">
          <span class="meta-icon">üìç</span>
          <%= @user.location %>
        </div>
      <% end %>
      <% if @user.website.present? %>
        <div class="meta-item">
          <span class="meta-icon">üîó</span>
          <%= link_to @user.website, @user.website, target: "_blank", rel: "nofollow" %>
        </div>
      <% end %>
      <% if @user.twitter_handle.present? %>
        <div class="meta-item">
          <span class="meta-icon">üê¶</span>
          <%= link_to "@#{@user.twitter_handle}", "https://twitter.com/#{@user.twitter_handle}", target: "_blank" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="profile-main">
    <nav class="profile-tabs">
      <%= link_to "Overview", user_profile_path(@user.username), class: "tab active" %>
      <%= link_to "Repositories (#{@repositories.count})", "#", class: "tab" %>
      <%= link_to "Projects", "#", class: "tab" %>
      <%= link_to "Packages", "#", class: "tab" %>
      <%= link_to "Stars", "#", class: "tab" %>
    </nav>

    <div class="repos-grid">
      <h2 class="section-title">Popular repositories</h2>
      <div class="pinned-repos">
        <% @repositories.limit(6).each do |repo| %>
          <div class="pinned-repo-card">
            <div class="repo-header">
              <%= link_to repo.name, repository_path(repo), class: "repo-link" %>
              <span class="repo-badge">Public</span>
            </div>
            <p class="repo-desc">Git repository managed by SL Labs.</p>
            <div class="repo-footer">
              <span class="repo-lang"><span class="lang-color"></span> Git</span>
              <span class="repo-updated">Updated <%= time_ago_in_words(repo.updated_at) %> ago</span>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<style>
  .profile-container { display: flex; gap: 2rem; margin-top: 2rem; align-items: flex-start; }
  
  .profile-sidebar { width: 296px; flex-shrink: 0; }
  .profile-avatar-container { position: relative; margin-bottom: 1rem; }
  .profile-avatar { width: 100%; border-radius: 50%; border: 1px solid var(--border-color); background: var(--bg-secondary); }
  .profile-avatar-placeholder { 
    width: 296px; height: 296px; border-radius: 50%; 
    background: linear-gradient(135deg, #2f81f7, #bc8cf2); 
    display: flex; align-items: center; justify-content: center;
    font-size: 5rem; font-weight: 800; color: white;
    border: 1px solid var(--border-color);
  }

  .profile-status {
    position: absolute; bottom: 20px; right: 0;
    background: var(--bg-main); border: 1px solid var(--border-color);
    padding: 4px 12px; border-radius: 20px; font-size: 0.85rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    display: flex; align-items: center; gap: 6px;
    max-width: 200px;
  }
  .status-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-primary); }

  .profile-names { margin-bottom: 1rem; }
  .profile-full-name { font-size: 1.6rem; font-weight: 700; margin: 0; font-family: var(--font-display); }
  .profile-username { font-size: 1.25rem; color: var(--text-secondary); font-weight: 300; }

  .profile-bio { font-size: 1rem; margin-bottom: 1.5rem; color: var(--text-primary); line-height: 1.4; }

  .btn-edit-profile { 
    display: block; width: 100%; text-align: center;
    padding: 6px 0; background: var(--bg-secondary);
    border: 1px solid var(--border-color); border-radius: 6px;
    color: var(--text-primary); text-decoration: none;
    font-weight: 500; font-size: 0.9rem; margin-bottom: 1.5rem;
    transition: background 0.2s;
  }
  .btn-edit-profile:hover { background: #1f2428; border-color: #8b949e; }

  .profile-meta { font-size: 0.9rem; color: var(--text-primary); }
  .meta-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
  .meta-item a { color: var(--text-primary); text-decoration: none; }
  .meta-item a:hover { color: var(--accent-color); text-decoration: underline; }
  .meta-icon { filter: grayscale(1); opacity: 0.8; width: 16px; text-align: center; }

  .profile-main { flex-grow: 1; }
  .profile-tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 1.5rem; gap: 1.5rem; }
  .tab { padding: 8px 4px; text-decoration: none; color: var(--text-secondary); border-bottom: 2px solid transparent; font-size: 0.9rem; font-weight: 500; }
  .tab:hover { color: var(--text-primary); border-bottom-color: var(--text-secondary); }
  .tab.active { color: var(--text-primary); border-bottom-color: #fd8c73; font-weight: 600; }

  .section-title { font-size: 1rem; font-weight: 400; margin-bottom: 1rem; color: var(--text-primary); }
  .pinned-repos { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  .pinned-repo-card { 
    border: 1px solid var(--border-color); border-radius: 6px; padding: 1rem;
    background: transparent; display: flex; flex-direction: column;
  }
  .repo-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
  .repo-link { font-weight: 600; color: var(--accent-color); text-decoration: none; font-size: 0.9rem; }
  .repo-link:hover { text-decoration: underline; }
  .repo-badge { font-size: 0.75rem; border: 1px solid var(--border-color); padding: 0 7px; border-radius: 20px; color: var(--text-secondary); }
  .repo-desc { font-size: 0.8rem; color: var(--text-secondary); flex-grow: 1; margin-bottom: 1rem; }
  .repo-footer { font-size: 0.75rem; color: var(--text-secondary); display: flex; gap: 1rem; }
  .lang-color { display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: #f1e05a; vertical-align: middle; margin-right: 4px; }

  @media (max-width: 768px) {
    .profile-container { flex-direction: column; align-items: center; text-align: center; }
    .profile-sidebar { width: 100%; max-width: 296px; }
    .pinned-repos { grid-template-columns: 1fr; }
    .profile-avatar-container { margin: 0 auto 1rem; }
  }
</style>
